---
# tasks file for zabbix-agent_role

- name: install zabbix-repo
  get_url:
    url: https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_7.0-2+ubuntu24.04_all.deb
    dest: /tmp/zabbix-release_7.0-2+ubuntu24.04_all.deb
    mode: '755'

- name: Install a .deb zabbix repo package
  ansible.builtin.apt:
    deb: /tmp/zabbix-release_7.0-2+ubuntu24.04_all.deb

- name: apt update after install deb packages for zabbix
  ansible.builtin.apt:
    update_cache: yes

- name: Install zabbix-agent
  ansible.builtin.apt:
    name: zabbix-agent

- name: change ip address zabbix-server
  shell: sed -i 's/Server=127.0.0.1/Server=192.168.10.200/g' /etc/zabbix/zabbix_agentd.conf
  notify:
    - restart zabbix agent